# Dockerfile for Superleme (Zotonic)
# Fixed to use native Docker arguments

# If you don't provide a version during build, it uses 28.
ARG ERLANG_VERSION=28

FROM erlang:${ERLANG_VERSION}

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    git \
    libssl-dev \
    make \
    imagemagick \
    libmagickwand-dev \
    postgresql-client \
    curl \
    wget \
    && rm -rf /var/lib/apt/lists/*

RUN wget https://s3.amazonaws.com/rebar3/rebar3 && \
    chmod +x rebar3 && \
    mv rebar3 /usr/local/bin/rebar3

# Create user zotonic (1000) inside the image
RUN groupadd -g 1000 zotonic || true \
    && useradd -m -u 1000 -g zotonic zotonic || true

# Set working directory
WORKDIR /opt/zotonic

# Expose ports
EXPOSE 8000 8443

CMD ["/bin/bash"]